<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Space Wars</title>
    <!-- Styles from both original files -->
    <link rel="stylesheet" href="css/front.css">
    <link rel="stylesheet" href="css/main.css">
    <!-- === ADD GOOGLE H5 ADS SCRIPTS HERE === -->
    <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-1234567890" crossorigin="anonymous"></script>

    <script>
        function adConfig(o) {
            (adsbygoogle = window.adsbygoogle || []).push(o);
        }
    </script>
</head>
<body>


    <!-- ===== NEW LOADING OVERLAY ===== -->
    <div id="loading-overlay" style="display: none;">
        <div class="loading-text">Loading...</div>
    </div>

    <!-- Audio player for background music -->
    <audio id="background-music" src="sounds/music.mp3" loop></audio>
    <!-- ... the rest of your body content ... -->



    <!-- Audio player for background music -->
    <audio id="background-music" src="sounds/music.mp3" loop></audio>

    <!-- ===== MAIN MENU (from front.html) ===== -->
    <div id="menu-container">
        <!-- Top Bar -->
        <div id="top-bar">
            <div id="menu-controls-desktop">
                <button class="button" style="background-image: url('Ui/list_button.png');"></button>
                
                <button class="button" id="shopButtonDesktop" style="background-image: url('Ui/shop_button.png');"></button>
                
                
                <button class="button" id="infoButtonDesktop" style="background-image: url('Ui/info_button.png');"></button>
              
            </div>
            <div class="currency-container">
                <div class="stat-panel" style="background-image: url('Ui/diamond_panel.png');">
                    <label id="diamond-label">0</label>
                </div>
                <div class="stat-panel" style="background-image: url('Ui/coin_panel.png');">
                    <label id="coin-label">0</label>
                </div>
            </div>
        </div>

        <!-- Center Content -->
        <div id="center-content">
            <img id="logo" src="Ui/logo.png" alt="Space Wars Logo">
            <!-- Play button now handled by script to show the game -->
            <a href="#" id="play-button-large"></a>
        </div>

        <!-- Bottom Bar (Mobile Only) -->
        <div id="menu-controls-mobile">
            <button class="button" style="background-image: url('Ui/list_button.png');"></button>
            
            <button class="button" id="shopButtonMobile" style="background-image: url('Ui/shop_button.png');"></button>
            
           <button class="button" id="infoButtonMobile" style="background-image: url('Ui/info_button.png');"></button>
            
        </div>
    </div>

    <!-- ===== GAME SCREEN (from index.html) - Hidden Initially ===== -->
    <div id="game-container" style="display: none;">
        <div id="gameDiv">
            <!-- The game's visual layers -->
            <div id="bgLayer1" class="bg-layer"></div>
            <div id="bgLayer2" class="bg-layer"></div>
            <img id="shieldBubble" src="images/bubble.png" style="display: none;">

            <!-- UI Structure -->
            <div id="ui-top">
                <!-- Left side controls -->
                <div id="ui-controls">
                    <button id="musicBtn" class="ui-button"></button>
                    <button id="soundBtn" class="ui-button"></button>
                    <button id="pauseBtn" class="ui-button"></button>
                </div>

                <!-- Right side stats -->
                <div id="ui-stats">
                    <div id="currency-container">
                        <div id="diamond-container" class="stat-panel">
                            <label id="diamondCountLabel">0</label>
                        </div>
                        <div id="coin-container" class="stat-panel">
                            <label id="coinCountLabel">0</label>
                        </div>
                    </div>
                    <div id="lives-score-container">
                        <div id="livesDiv">
                            <!-- Hearts will be added by JS -->
                        </div>
                        <span id="scoreLabel">0</span>
                    </div>
                </div>
            </div>

                           <!-- ================= FINAL CORRECTED REVIVAL POPUPS ================= -->
            <div id="revival-popup-1" class="revival-popup" style="display: none;">
                <div class="revival-timer">
                    <span id="revival-timer-label">6</span> sec
                </div>
                <!-- THIS DIV IS NOW ADDED BACK to show the "+1" -->
                <div class="revival-offer-text"></div>
                <div class="revival-buttons">
                    <button id="revive-diamond-btn">
                        
                        <span>2</span>
                    </button>
                    <button id="revive-ad-btn">
                
                        <span></span>
                    </button>
                
                </div>
                <div class="nothing"></div>
            </div>

            <div id="revival-popup-2" class="revival-popup" style="display: none;">
                 <!-- THIS DIV IS NOW ADDED BACK to show the "+2" -->
                <div class="revival-offer-text">2</div>
                <p class="bonus-offer-subtext">BONUS LIVES!</p>
                <div class="revival-buttons">
                    <button id="bonus-diamond-btn">
                      
                        <span>5</span>
                    </button>
                    <button id="bonus-ad-btn">
                       
                        <span></span>
                    </button>
                </div>
                <button id="skip-bonus-btn"></button>
            </div>
            <!-- ======================= REVIVAL POPUPS END ======================= -->              

                           <!-- ======================= REVIVAL POPUPS END ======================= -->

            <div id="gameOver"></div>
        </div>
        <!-- ================= NEW GAME OVER SCREEN STRUCTURE ================= -->
<div id="gameOverScreen" style="display: none;">
    <div id="gameOverBackground"></div>
    <div id="gameOverContent">
        <div id="gameOverTopBar">
            <div id="gameOverControls">
                <button id="gameOverMusicBtn" class="ui-button"></button>
                <button id="gameOverSoundBtn" class="ui-button"></button>
            </div>
            <button id="gameOverCloseBtn" class="ui-button"></button>
        </div>
                <img src="Ui/game_over.png" id="gameOverTitleDesktop" alt="Game Over" style="filter: drop-shadow(0 0 12px white);">
                
                
        <div id="gameOverMain">

              
            <!-- Desktop Score Panel -->
            <div id="gameOverScorePanel">
                <span class="score-title">Your Score</span>
                <span id="gameOverScoreValue" class="score-value">0</span>
                <span class="score-title">High score:</span>
                <span id="gameOverHighScoreValue" class="score-value">0</span>
            </div>

            <!-- Rewards Section (for both mobile and desktop) -->
            <div id="gameOverRewards">

                <img src="Ui/High_score_panel.png" id="highScoreTitle" alt="High Score">
              
                <!-- Mobile-only score display -->
                <div id="gameOverMobileScore">
                    <span id="gameOverMobileScoreValue">0</span>
                    <span class="score-title">High score: <span id="gameOverMobileHighScoreValue">0</span></span>
                </div>

                <div id="gameOverCurrency">
                    <div class="stat-panel">
                        <label id="gameOverDiamondValue">0</label>
                    </div>
                    <div class="stat-panel">
                        <label id="gameOverCoinValue">0</label>
                    </div>
                </div>
                <span id="double-coin-text">2x Your Coin</span>
                <button id="doubleCoinsAdBtn"></button>
            </div>
        </div>
    </div>
</div>
<!-- ======================= END GAME OVER SCREEN ======================= -->
    </div>






    <!-- ================= NEW SETTINGS POPUP STRUCTURE ================= -->
<div id="settingsPopup" style="display: none;">
    <button id="closeSettingsBtn" class="button"></button>
    <div class="popup-buttons-grid">
        
        <button id="soundBtnPopup" class="popup-btn"></button>
        <button id="musicBtnPopup" class="popup-btn"></button>
    </div>
</div>
<!-- ======================= END POPUP STRUCTURE ======================= -->





    <!-- ===== SCRIPTS ===== -->
  <!-- ===== SCRIPTS ===== -->
    <script>
    // This wrapper ensures the script only runs after the page's HTML is ready.
    document.addEventListener('DOMContentLoaded', function() {
    
        // --- UI ELEMENTS ---
        const menuContainer = document.getElementById('menu-container');
        const gameContainer = document.getElementById('game-container');
        const playButton = document.getElementById('play-button-large');
        const loadingOverlay = document.getElementById('loading-overlay');
        const music = document.getElementById('background-music');
        const settingsPopup = document.getElementById('settingsPopup');
        const closeSettingsBtn = document.getElementById('closeSettingsBtn');
        const musicBtnPopup = document.getElementById('musicBtnPopup');
        const soundBtnPopup = document.getElementById('soundBtnPopup');
        const settingsBtns = document.querySelectorAll('.button[style*="list_button.png"]');

        // --- GOOGLE H5 ADS CONFIGURATION ---
        // This function tells Google to get ads ready in the background.
        function configureAds() {
            // Check the player's sound preference before configuring ads
            let isMuted = localStorage.getItem('isMusicMuted') === 'true';
            adConfig({
                sound: isMuted ? 'off' : 'on', // Tell Google if sound should be on or off
                preloadAdBreaks: 'on'          // A key performance setting
            });
            console.log("Google H5 Ads configured.");
        }

        // --- PRELOADER LOGIC ---
        // 1. List all essential game images here for the preloader
        const imagesToPreload = [
            'images/background.png', 'images/plane-c.png', 'images/plane-c1.png', 'images/plane-c2.png',
            'images/plane-c3.png', 'images/bullet.png', 'images/bullet_enemy.png', 'images/enemy-1.png',
            'images/enemy-2.png', 'images/enemy-3.png', 'images/enemy-4.png', 'images/enemy-5.png',
            'images/enemy-6.png', 'images/enemy-7.png', 'images/explosion.png', 'images/coin.png',
            'images/diamond.png', 'images/bolt.png', 'images/shield.png', 'images/magnet.png',
            'images/booster.png', 'images/bubble.png', 'Ui/heart_full.png', 'Ui/heart_empty.png'
            // Add any other CRITICAL gameplay images here
        ];
        
        let imagesLoaded = 0;

        function preloadAssets() {
            console.log("Starting asset preloading...");
            for (const src of imagesToPreload) {
                const tempImage = new Image();
                tempImage.onload = imageLoaded;
                tempImage.onerror = imageLoaded; // Count errors too so we don't get stuck
                tempImage.src = src;
            }
        }

        function imageLoaded() {
            imagesLoaded++;
            // When all images are loaded, show the main menu
            if (imagesLoaded >= imagesToPreload.length) {
                console.log("All assets preloaded. Showing main menu.");
                loadingOverlay.style.display = 'none'; // Hide our custom loading screen
                menuContainer.style.visibility = 'visible'; // Show the main menu
            }
        }

        // --- SCRIPT INITIALIZATION (What happens when the page loads) ---

        // 1. Configure Google Ads immediately
        configureAds();

        // 2. Hide your menu and show the "Loading..." text
        menuContainer.style.visibility = 'hidden'; 
        loadingOverlay.style.display = 'flex';
        
        // 3. Start preloading all your images
        preloadAssets();
        
        // 4. Set up all your menu logic while assets are loading in the background
        let isMusicMuted = localStorage.getItem('isMusicMuted') === 'true';
        let isSfxMuted = localStorage.getItem('isSfxMuted') === 'true';

        function applyMuteStates() {
            music.muted = isMusicMuted;
            if (musicBtnPopup) musicBtnPopup.classList.toggle('muted', isMusicMuted);
            if (soundBtnPopup) soundBtnPopup.classList.toggle('muted', isSfxMuted);
            if (!isMusicMuted && music.paused) {
                music.play().catch(error => {
                    document.body.addEventListener('click', () => music.play(), { once: true });
                });
            } else if (isMusicMuted) {
                music.pause();
            }
        }
        
        const diamondLabel = document.getElementById('diamond-label');
        const coinLabel = document.getElementById('coin-label');
        diamondLabel.textContent = localStorage.getItem('savedDiamonds') || '0';
        coinLabel.textContent = localStorage.getItem('savedCoins') || '0';
        const savedTime = parseFloat(localStorage.getItem('musicTime') || '0');
        music.currentTime = savedTime;
        applyMuteStates();

        // --- EVENT LISTENERS ---

        document.addEventListener('visibilitychange', function() {
            if (document.hidden) {
                music.muted = true;
            } else {
                music.muted = localStorage.getItem('isMusicMuted') === 'true';
            }
        });

        playButton.addEventListener('click', function(event) {
            event.preventDefault();
            menuContainer.style.display = 'none';
            gameContainer.style.display = 'flex';
            // The startGame() function is in main.js, which should already be loaded
            startGame(); 
        });
        
        document.getElementById('infoButtonDesktop').addEventListener('click', () => window.location.replace('info.html'));
        document.getElementById('shopButtonDesktop').addEventListener('click', () => window.location.replace('shop.html'));
        document.getElementById('infoButtonMobile').addEventListener('click', () => window.location.replace('info.html'));
        document.getElementById('shopButtonMobile').addEventListener('click', () => window.location.replace('shop.html'));
        
        settingsBtns.forEach(btn => {
            btn.addEventListener('click', (e) => {
                e.preventDefault();
                settingsPopup.style.display = 'flex';
            });
        });

        closeSettingsBtn.addEventListener('click', (e) => {
            e.preventDefault();
            settingsPopup.style.display = 'none';
        });

        musicBtnPopup.addEventListener('click', (e) => {
            e.preventDefault();
            isMusicMuted = !isMusicMuted;
            localStorage.setItem('isMusicMuted', isMusicMuted);
            applyMuteStates();
            // Also update the ad config for the next ad call
            configureAds();
        });

        soundBtnPopup.addEventListener('click', (e) => {
            e.preventDefault();
            isSfxMuted = !isSfxMuted;
            localStorage.setItem('isSfxMuted', isSfxMuted);
            applyMuteStates();
        });
    });
    </script>
    <script>
        // Disable right-click menu
        window.addEventListener('contextmenu', function (e) { 
            e.preventDefault(); 
        }, false);
    </script>
</body>
</html>